<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß CORS Fix Test - Koda App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #007a62, #005a43);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .test-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .status-good { border-color: #10b981; }
        .status-bad { border-color: #ef4444; }
        .status-pending { border-color: #f59e0b; }
        
        button {
            background: white;
            color: #007a62;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .url-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            word-break: break-all;
        }
        
        #results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }
        
        .error { color: #fca5a5; }
        .success { color: #86efac; }
        .warning { color: #fde047; }
        
        iframe {
            width: 100%;
            height: 600px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß CORS Fix Test</h1>
        <h2>Koda App Deployment Verification</h2>
        <p>Testing if the CORS error has been resolved for koda.kocreators.com</p>
    </div>

    <div class="test-section status-pending">
        <h3>üéØ Target URL</h3>
        <div class="url-box">
            https://koda.kocreators.com
        </div>
        <button onclick="testKodaApp()">üß™ Test Koda App</button>
        <button onclick="checkConsoleErrors()">üîç Check Console</button>
        <button onclick="window.open('https://koda.kocreators.com', '_blank')">üåê Open in New Tab</button>
    </div>

    <div class="test-section status-pending">
        <h3>üîç CORS Error Check</h3>
        <p>Previous error was assets loading from CloudFront while page served from custom domain.</p>
        <p><strong>Fixed by:</strong> Setting Vite base to '/' and deploying to S3 root</p>
        
        <h4>Expected Results:</h4>
        <ul>
            <li>‚úÖ No CORS errors in console</li>
            <li>‚úÖ All assets load from koda.kocreators.com</li>
            <li>‚úÖ JavaScript and CSS work properly</li>
            <li>‚úÖ KODA app displays correctly</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>üìä Test Results</h3>
        <div id="results">
            <p>Click "Test Koda App" to run diagnostics...</p>
        </div>
    </div>

    <div class="test-section">
        <h3>üñ•Ô∏è Live Preview</h3>
        <p>If no CORS errors, the app should load properly below:</p>
        <iframe src="https://koda.kocreators.com" id="koda-frame" onload="handleFrameLoad()" onerror="handleFrameError()"></iframe>
    </div>

    <script>
        let testResults = [];

        function addResult(message, type = 'info') {
            testResults.push({message, type, time: new Date().toLocaleTimeString()});
            updateResults();
        }

        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = testResults.map(result => 
                `<div class="${result.type}">
                    [${result.time}] ${result.message}
                </div>`
            ).join('');
        }

        function testKodaApp() {
            addResult('üß™ Starting Koda App test...', 'info');
            
            // Test if the page loads
            fetch('https://koda.kocreators.com')
                .then(response => {
                    if (response.ok) {
                        addResult('‚úÖ Koda app loads successfully (HTTP 200)', 'success');
                        
                        // Check for common CORS indicators
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(html => {
                    // Check if HTML contains CloudFront URLs (would cause CORS)
                    if (html.includes('d3d8ucpm7p01n7.cloudfront.net')) {
                        addResult('‚ö†Ô∏è Warning: HTML still contains CloudFront URLs', 'warning');
                        addResult('This may cause CORS errors', 'warning');
                    } else {
                        addResult('‚úÖ HTML uses relative paths (CORS fixed)', 'success');
                    }
                    
                    // Check for KODA title
                    if (html.includes('KODA') || html.includes('koda')) {
                        addResult('‚úÖ KODA content detected in HTML', 'success');
                    } else {
                        addResult('‚ö†Ô∏è KODA content not found in HTML', 'warning');
                    }
                })
                .catch(error => {
                    addResult(`‚ùå Koda app failed to load: ${error.message}`, 'error');
                });
        }

        function checkConsoleErrors() {
            addResult('üîç Check browser console for CORS errors', 'info');
            addResult('Look for: "Access-Control-Allow-Origin" errors', 'info');
            addResult('If you see CORS errors, the fix needs more time to propagate', 'warning');
        }

        function handleFrameLoad() {
            addResult('‚úÖ Iframe loaded successfully', 'success');
            
            // Try to access iframe content (will fail with CORS)
            try {
                const frame = document.getElementById('koda-frame');
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                if (frameDoc) {
                    addResult('‚úÖ Iframe content accessible (no CORS blocking)', 'success');
                }
            } catch (e) {
                if (e.message.includes('cross-origin')) {
                    addResult('‚ö†Ô∏è Iframe blocked by CORS (expected for security)', 'info');
                } else {
                    addResult(`‚ÑπÔ∏è Iframe access: ${e.message}`, 'info');
                }
            }
        }

        function handleFrameError() {
            addResult('‚ùå Iframe failed to load', 'error');
        }

        // Auto-run test after page loads
        setTimeout(() => {
            testKodaApp();
        }, 1000);
    </script>
</body>
</html>